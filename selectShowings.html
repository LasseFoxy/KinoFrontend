<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Showings</title>
    <style>
        /* Rød og grøn farve for valgte og ledige showings */
        .showing-booked {
            background-color: red;
            color: white;
        }

        .showing-available {
            background-color: green;
            color: white;
        }

        .showing-selected {
            background-color: blue;
            color: white;
        }
    </style>
</head>
<body>
<h1>Tilføj visninger</h1>
<label for="movieSelect">Vælg film:</label>
<select id="movieSelect"></select>

<label for="theaterSelect">Vælg biografsal:</label>
<select id="theaterSelect"></select>

<div id="week-container">
    <!-- Ugevisningen for visninger indsættes her -->
</div>

<button id="prevWeekButton">Forrige uge</button>
<button id="nextWeekButton">Næste uge</button>

<button id="saveButton">Gem valgte visninger</button>
<button id="backButton">Tilbage</button>

<script>
    let selectedShowings = []; // Holder styr på de valgte visninger
    let currentWeek = 0; // Start uge = nuværende uge

    document.addEventListener('DOMContentLoaded', () => {
        loadMovies();
        loadTheaters();
        loadShowingsForCurrentWeek();
    });

    // Load movies and theaters
    function loadMovies() {
        fetch('http://localhost:8080/api/movies')
            .then(response => response.json())
            .then(movies => {
                const movieSelect = document.getElementById('movieSelect');
                movieSelect.innerHTML = '';
                movies.forEach(movie => {
                    const option = document.createElement('option');
                    option.value = movie.movieId;
                    option.textContent = movie.title;
                    movieSelect.appendChild(option);
                });
            });
    }

    function loadTheaters() {
        fetch('http://localhost:8080/api/theater')
            .then(response => response.json())
            .then(theaters => {
                const theaterSelect = document.getElementById('theaterSelect');
                theaterSelect.innerHTML = '';
                theaters.forEach(theater => {
                    const option = document.createElement('option');
                    option.value = theater.theaterId;
                    option.textContent = theater.name;
                    theaterSelect.appendChild(option);
                });
            });
    }

    function loadShowingsForCurrentWeek() {
        const theaterId = document.getElementById('theaterSelect').value;
        const startDate = new Date(); // Startdato er dags dato
        startDate.setDate(startDate.getDate() + currentWeek * 7); // Juster ugen

        fetch(`http://localhost:8080/api/theater/${theaterId}/showings?startDate=${startDate.toISOString()}`)
            .then(response => response.json())
            .then(showings => {
                displayWeek(showings, startDate);
            });
    }

    function displayWeek(showings, startDate) {
        const weekContainer = document.getElementById('week-container');
        weekContainer.innerHTML = ''; // Ryd tidligere visninger

        for (let i = 0; i < 7; i++) {
            const day = new Date(startDate);
            day.setDate(day.getDate() + i); // Fremad med en dag ad gangen

            const dayDiv = document.createElement('div');
            dayDiv.innerHTML = `<h3>${day.toDateString()}</h3>`;

            const dayShowings = showings.filter(showing => new Date(showing.date).toDateString() === day.toDateString());
            ['12:00', '16:00', '20:00'].forEach(time => {
                const showingDiv = document.createElement('div');
                const matchingShowing = dayShowings.find(showing => showing.startTime === time);

                if (matchingShowing) {
                    showingDiv.className = 'showing-booked'; // Hvis der allerede er en film
                    showingDiv.textContent = time + " - Optaget";
                } else {
                    showingDiv.className = 'showing-available'; // Hvis tid er ledig
                    showingDiv.textContent = time + " - Ledig";
                    showingDiv.onclick = () => toggleSelect(showingDiv, day, time);
                }

                dayDiv.appendChild(showingDiv);
            });

            weekContainer.appendChild(dayDiv);
        }
    }

    function toggleSelect(showingDiv, date, time) {
        const showingKey = `${date}-${time}`;

        if (selectedShowings.includes(showingKey)) {
            selectedShowings = selectedShowings.filter(key => key !== showingKey);
            showingDiv.className = 'showing-available';
        } else {
            selectedShowings.push(showingKey);
            showingDiv.className = 'showing-selected';
        }
    }

    document.getElementById('prevWeekButton').onclick = () => {
        currentWeek--;
        loadShowingsForCurrentWeek();
    };

    document.getElementById('nextWeekButton').onclick = () => {
        currentWeek++;
        loadShowingsForCurrentWeek();
    };

    document.getElementById('saveButton').onclick = () => {
        const movieId = document.getElementById('movieSelect').value;
        const theaterId = document.getElementById('theaterSelect').value;

        const requestBody = {
            movieId: movieId,
            theaterId: theaterId,
            selectedShowings: selectedShowings
        };

        fetch('http://localhost:8080/api/theater/saveShowings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestBody)
        })
            .then(response => {
                if (response.ok) {
                    alert('Visninger gemt!');
                } else {
                    response.text().then(text => alert(text));
                }
            });
    };

</script>
</body>
</html>
